@model IEnumerable<CompanyViewModel>

@{
	ViewData["Title"] = "Companies";
}

<link rel="stylesheet" href="~/css/companies/index.css" asp-append-version="true" />

<div class="container-fluid py-3">
	@Html.AntiForgeryToken()

	<!-- Header -->
	<div class="d-flex justify-content-between align-items-center mb-3">
		<div>
			<h1 class="h4 mb-0 fw-700">Companies</h1>
			@if (!string.IsNullOrWhiteSpace(ViewBag.Search))
			{
					<p class="text-muted mb-0">
						<small>
							<i class="fas fa-search me-1"></i>
							Showing results for: "<strong>@ViewBag.Search</strong>"
						</small>
					</p>
			}
		</div>
		<a href="@Url.Action("Create")" class="btn btn-success">
			<i class="fas fa-plus me-1"></i>Add Company
		</a>
	</div>

	<!-- Search Card -->
	<div class="card mb-3">
		<div class="card-body">
			<form method="get" class="row g-2">
				<div class="col-md-9">
					<div class="input-group">
						<span class="input-group-text">
							<i class="fas fa-search"></i>
						</span>
						<input type="text" 
							   name="search" 
							   class="form-control" 
							   placeholder="Search by company name, address, phone, email or director..." 
							   value="@ViewBag.Search" />
					</div>
				</div>
				<div class="col-md-3">
					<div class="d-flex gap-2">
						<button type="submit" class="btn btn-primary flex-grow-1">
							<i class="fas fa-search me-1"></i>Search
						</button>
						@if (!string.IsNullOrWhiteSpace(ViewBag.Search))
						{
								<a href="@Url.Action("Index")" class="btn btn-outline-secondary">
									<i class="fas fa-times me-1"></i>Clear
								</a>
						}
					</div>
				</div>
			</form>

			<!-- Search Results Info -->
			@if (!string.IsNullOrWhiteSpace(ViewBag.Search))
			{
					<div class="mt-3">
						<div class="alert alert-info alert-dismissible fade show mb-0 py-2" role="alert">
							<div class="d-flex align-items-center">
								<i class="fas fa-info-circle me-2"></i>
								<div>
									<span class="fw-600">@Model.Count()</span> 
								@(Model.Count() == 1 ? "company" : "companies") found matching 
									"<strong>@ViewBag.Search</strong>"
								</div>
								<button type="button" class="btn-close ms-auto" data-bs-dismiss="alert"></button>
							</div>
						</div>
					</div>
			}
		</div>
	</div>

	<!-- Companies Table -->
	<div class="card">
		<div class="table-responsive">
			<table class="table table-hover mb-0">
				<thead class="table-light">
					<tr>
						<th class="ps-4">Company Name</th>
						<th>Director</th>
						<th>Phone</th>
						<th>Email</th>
						<th>Address</th>
						<th class="text-center">Actions</th>
					</tr>
				</thead>
				<tbody>
					@if (Model.Any())
					{
						@foreach (var company in Model)
						{
									<tr>
										<td>
											<span class="fw-600">@company.Name</span>
										</td>
										<td>
											<span>@company.Director</span>
										</td>
										<td>
											<span>@company.Phone</span>
										</td>
										<td>
											<span>@company.Email</span>
										</td>
										<td>
											<span>@company.Address</span>
										</td>
										<td class="text-center">
											<div class="btn-group btn-group-sm" role="group">
												<a href="@Url.Action("Details", new { id = company.Id })" 
												style="border: 2px groove green" class="btn btn-outline-secondary" title="View">
													<i class="fas fa-eye"></i>
												</a>
												<a href="@Url.Action("Edit", new { id = company.Id })" class="btn btn-outline-secondary"
												   style="border: 2px groove yellow; margin-left: 5px; margin-right: 5px" title="Edit">
													<i class="fas fa-edit"></i>
												</a>
												<button type="button" class="btn btn-outline-danger" data-bs-toggle="modal"
												style="border: 2px groove red" data-bs-target="#deleteModal@(company.Id)" title="Delete">
													<i class="fas fa-trash"></i>
												</button>
											</div>

											<!-- Delete Modal -->
											<div class="modal fade" id="deleteModal@(company.Id)" tabindex="-1">
												<div class="modal-dialog">
													<div class="modal-content">
														<div class="modal-header">
															<h5 class="modal-title">Delete Company</h5>
															<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
														</div>
														<div class="modal-body">
															<p>Are you sure you want to delete <strong>@company.Name</strong>?</p>
															<p class="text-danger small"><i class="fas fa-warning me-2"></i>This action cannot be undone.</p>
														</div>
														<div class="modal-footer">
															<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
															<button type="button" class="btn btn-danger" onclick="deleteCompany(@company.Id)">Delete</button>
														</div>
													</div>
												</div>
											</div>
										</td>
									</tr>
						}
					}
					else
					{
							<tr>
								<td colspan="6" class="text-center py-5">
								@if (!string.IsNullOrWhiteSpace(ViewBag.Search))
								{
											<i class="fas fa-search text-muted" style="font-size: 3rem;"></i>
											<p class="text-muted mt-3">No companies found matching "@ViewBag.Search"</p>
											<a href="@Url.Action("Index")" class="btn btn-outline-primary mt-2">
												<i class="fas fa-list me-1"></i>Show all companies
											</a>
								}
								else
								{
											<i class="fas fa-inbox text-muted" style="font-size: 3rem;"></i>
											<p class="text-muted mt-3">No companies found</p>
											<a href="@Url.Action("Create")" class="btn btn-primary mt-2">
												<i class="fas fa-plus me-1"></i>Add your first company
											</a>
								}
								</td>
							</tr>
					}
				</tbody>
			</table>
		</div>

		<!-- Results. Count Footer -->
		@if (Model.Any())
		{
				<div class="card-footer d-flex justify-content-between align-items-center">
					<div>
						<span class="text-muted">
							Showing <strong>@Model.Count()</strong> 
						@(Model.Count() == 1 ? "company" : "companies")
						@if (!string.IsNullOrWhiteSpace(ViewBag.Search))
						{
									<span>matching "<strong>@ViewBag.Search</strong>"</span>
						}
						</span>
					</div>
				@if (!string.IsNullOrWhiteSpace(ViewBag.Search))
				{
							<div>
								<a href="@Url.Action("Index")" class="btn btn-sm btn-outline-secondary">
									<i class="fas fa-times me-1"></i>Clear search
								</a>
							</div>
				}
				</div>
		}
	</div>
</div>

<script src="~/js/companies/index.js" asp-append-version="true"></script>
